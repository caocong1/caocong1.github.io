<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, viewport-fit=cover">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="default">
	<meta name="theme-color" content="#2196f3">
	<meta http-equiv="Content-Security-Policy" content="default-src * 'self' 'unsafe-inline' 'unsafe-eval' data: gap:">
	<title>投票</title>
	<link rel="stylesheet" href="css/framework7.css">
</head>
<body>
<div id="app">
	<div class="statusbar"></div>
	<div class="panel panel-left panel-cover"></div>
	<div class="panel panel-right panel-reveal"></div>
	<div class="view view-main view-init ios-edges" data-url="/">
		<div class="page">
		</div>
	</div>
</div>
<template id="tmpl-page">
	<div class="navbar">
		<div class="navbar-inner">
			<div class="title sliding">节目投票</div>
		</div>
	</div>
	<div class="page-content">
		<div class="list" id="list-program">
		</div>
		<div class="block">
			<div class="row">
				<button class="col button button-fill color-gray vote-cancel">重置</button>
				<button class="col button button-fill vote-confirm">提交</button>
			</div>
		</div>
	</div>
</template>
<template id="tmpl-listprogram">
	<ul>
		{{#each list}}
		<li>
			<label class="item-checkbox item-content">
				<input type="checkbox" data-num="{{@index+1}}"/>
				<i class="icon icon-checkbox"></i>
				<div class="item-inner">
					<div class="item-title">{{@index+1}}、{{title}}</div>
				</div>
			</label>
		</li>
		{{/each}}
	</ul>
</template>
<script src="js/framework7.js"></script>
<!--<script src="js/routes.js"></script>-->
<script>
  (function () {
    const $$ = Dom7
 let isw = is_weixn()?'yes':'no'
 document.getElementsByTagName('body')[0].innerHTML = navigator.userAgent.toLowerCase()+isw
    let app = new Framework7({
      id: 'vote',
      root: '#app',
      theme: 'auto',
      dialog: {
        buttonOk: '确认',
        buttonCancel: '取消'
      },
      on: {
        pageInit: function () {
          if (is_weixn()) {
            // https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxa32c03e9f0ccacc0&redirect_uri=REDIRECT_URI&response_type=code&scope=snsapi_base&state=STATE#wechat_redirect

            // pageInit()
          } else {
            this.dialog.alert('', '请在微信里打开!', function () {
              // $$('#app').remove()
            })
          }
        }
      }
    })

    let checktotal = 0
    $$('#list-program').find('input').on('change', e => {
      e.target.checked ? checktotal++ : checktotal--
      if (checktotal === 3) {
        $$('#list-program').find('input').each((i, el) => {
          el.disabled = !el.checked
          if (!el.checked) {
            $$(el).parent().parent().css('background-color', '#f5f5f5')
          }
        })
      } else {
        $$('#list-program').find('input').prop('disabled', false)
        $$('#list-program').find('li').removeAttr('style')
      }
    })
    $$('.vote-cancel').on('click', () => {
      $$('#list-program').find('input').each((i, el) => {
        el.checked = false
      })
    })
    $$('.vote-confirm').on('click', () => {
      let text = ''
      $$('#list-program').find('input').each((i, el) => {
        if (el.checked) {
          text += `<li>${$$(el).parent().find('.item-title').text()}</li>`
        }
      })
      app.dialog.confirm(`您选择的节目番号是：${text}`, '确认是否投票?', function () {
        app.dialog.alert('', '投票成功，感谢您的支持!')
      })
    })

	  function pageInit () {
      $$('.page').html($$('#tmpl-page').html())
      let pdata = {
        list: [{
          title: '节目A'
        }, {
          title: '节目B'
        }, {
          title: '节目C'
        }, {
          title: '节目D'
        }, {
          title: '节目E'
        }, {
          title: '节目F'
        }, {
          title: '节目G'
        }]
      }
      let plistTemplate = Template7.compile($$('#tmpl-listprogram').html())
      let html = plistTemplate(pdata)
      $$('#list-program').html(html)
    }

    function is_weixn () {
      var ua = navigator.userAgent.toLowerCase()
      return /micromessenger/.test(ua)
    }
  })()

</script>
</body>
</html>
